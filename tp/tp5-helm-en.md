## Helm

- Clean the cluster with the following commands:

```shell
kubectl delete deploy,ds,svc --all
kubectl delete pvc,pv --all
kubectl delete pods --all
docker image rm $(docker image ls -q)
```

- Install the `helm` client ([documentation](https://helm.sh/docs/intro/install/))

```shell
# don't curl | bash IRL
curl -s https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash
```

- Check that `Helm` is correctly installed:

```shell
helm version
```

- Create a `dockercoins` Namespace:

```shell
kubectl create ns dockercoins
```

- Go in the `dockercoins` directory
- Look at the `values.yml` file content
- Get the dependencies:

```shell
helm dependency update
```

- Deploy a release:

```shell
public_ip=${PUBLIC_IP}  # or $(minikube ip)
echo "public_ip: ${public_ip}"
helm install dockercoins . \
  --set ingress.webui.host=dockercoins.${public_ip}.xip.io \
  --namespace dockercoins
```

- Look at output generated by the installation
- Watch the creation of the Pods in the `dockercoins` Namespace
- Check the application in your browser at the following url `dockercoins.<PUBLIC_IP>.xip.io`
- List the releases with `helm list --namespace dockercoins`
- Increase the number of worker replicas:

```shell
helm upgrade dockercoins \
  --reuse-values \
  --set replicaCount.worker=2 . \
  --namespace dockercoins
```

- Update the worker:

```shell
helm upgrade dockercoins \
  --reuse-values \
  --set image.worker.version=1.1 . \
  --namespace dockercoins
```

- Watch the upgrade with the command `watch kubectl get pods,rs,ds,deploy,svc,ing -o wide -n dockercoins`

